name: Test OS SDK CLI from OpenStudio Application

on:
  workflow_dispatch:
    inputs:
      run_id:
        description: 'The github actions run_id where to find the artifacts'
        required: true

jobs:
  test:
    runs-on: ${{ matrix.os }}
    continue-on-error: true
    strategy:
      # fail-fast: Default is true, switch to false to allow one platform to fail and still run others
      fail-fast: false
      matrix:
        os: [ubuntu-20.04, ubuntu-22.04, windows-2022, macos-13, macos-arm64]
        include:
        - os: ubuntu-20.04
          SELF_HOSTED: false
          PLATFORM_NAME: Linux
          BINARY_EXT: deb
          COMPRESSED_EXT: tar.gz
        - os: ubuntu-22.04
          SELF_HOSTED: false
          PLATFORM_NAME: Linux
          BINARY_EXT: deb
          COMPRESSED_EXT: tar.gz
        - os: windows-2022
          SELF_HOSTED: false
          PLATFORM_NAME: Windows
          BINARY_EXT: exe
          COMPRESSED_EXT: zip
        - os: macos-13
          SELF_HOSTED: false
          PLATFORM_NAME: Darwin
          BINARY_EXT: dmg
          COMPRESSED_EXT: tar.gz
          MACOSX_DEPLOYMENT_TARGET: 10.15
        - os: macos-arm64
          SELF_HOSTED: true
          PLATFORM_NAME: Darwin
          BINARY_EXT: dmg
          COMPRESSED_EXT: tar.gz
          MACOSX_DEPLOYMENT_TARGET: 12.1

    steps:
    - name: Download binary installer
      uses: actions/download-artifact@v4
      with:
        pattern: OpenStudioApplication-*-${{ matrix.os }}.${{ matrix.BINARY_EXT }}
        run-id: ${{ github.event.inputs.run_id}}
        github-token: ${{ secrets.GITHUB_TOKEN }}

    - name: Display structure of downloaded files
      run: |
        ls -R
